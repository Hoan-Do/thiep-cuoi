<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ho√†n&Huy·ªÅn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // C·∫•u h√¨nh log ƒë·ªÉ d·ªÖ debug
        setLogLevel('debug');

        let db, auth, userId;
        
        // B∆Ø·ªöC 1: D√ÅN "appId" c·ªßa b·∫°n v√†o ƒë√¢y
        // S·ª≠ d·ª•ng projectId c·ªßa b·∫°n
        const appId = 'thiep-cuoi-c3d08';

        // B∆Ø·ªöC 2: D√ÅN "firebaseConfig" c·ªßa b·∫°n v√†o ƒë√¢y
        // Sao ch√©p v√† d√°n to√†n b·ªô ƒë·ªëi t∆∞·ª£ng t·ª´ Firebase Console > Project settings > Your apps
        const firebaseConfig = {
            apiKey: "AIzaSyBA68TNBDx4T23PfkZTcU1RwWmDeQUgY",
            authDomain: "thiep-cuoi-c3d08.firebaseapp.com",
            projectId: "thiep-cuoi-c3d08",
            storageBucket: "thiep-cuoi-c3d08.appspot.com",
            messagingSenderId: "221614290",
            appId: "1:221614290:web:a3db7a9973261b9b3a0d8b"
        };
        
        // L∆ØU √ù QUAN TR·ªåNG: C·∫¨P NH·∫¨T FIREBASE SECURITY RULES
        // L·ªói "ƒëang ƒëƒÉng nh·∫≠p" c√≥ th·ªÉ l√† do thi·∫øu quy·ªÅn truy c·∫≠p.
        // Vui l√≤ng v√†o Firebase Console > Firestore Database > Rules
        // v√† thay th·∫ø to√†n b·ªô n·ªôi dung b·∫±ng ƒëo·∫°n code d∆∞·ªõi ƒë√¢y.
        // ƒêi·ªÅu n√†y s·∫Ω cho ph√©p ng∆∞·ªùi d√πng ƒë√£ x√°c th·ª±c (bao g·ªìm c·∫£ ·∫©n danh)
        // ƒë·ªçc v√† vi·∫øt d·ªØ li·ªáu v√†o b·ªô s∆∞u t·∫≠p 'guestbook'.
        //
        // rules_version = '2';
        // service cloud.firestore {
        //   match /databases/{database}/documents {
        //     match /artifacts/{appId}/public/data/guestbook/{messageId} {
        //       allow read, write: if request.auth != null;
        //     }
        //   }
        // }
        
        // Ki·ªÉm tra n·∫øu l√† ch·∫ø ƒë·ªô admin
        const urlParams = new URLSearchParams(window.location.search);
        const isAdminMode = urlParams.get('admin') === 'true';
        const guestName = urlParams.get('to');

        // Hi·ªÉn th·ªã t√™n kh√°ch m·ªùi n·∫øu c√≥
        if (guestName) {
            document.addEventListener('DOMContentLoaded', () => {
                const guestNameElement = document.getElementById('guest-name-display');
                if (guestNameElement) {
                    guestNameElement.textContent = decodeURIComponent(guestName);
                }
            });
        }

        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    console.log("User signed in:", userId);
                    if (document.getElementById('user-id')) {
                        document.getElementById('user-id').textContent = userId;
                    }
                    if (isAdminMode && !user.isAnonymous) {
                        loadAdminPanel();
                    } else if (!isAdminMode) {
                        loadGuestbook();
                    }
                } else {
                    console.log("No user signed in yet, signing in anonymously...");
                    if (document.getElementById('user-id')) {
                        document.getElementById('user-id').textContent = 'ƒêang ƒëƒÉng nh·∫≠p...';
                    }
                }
            });

            if (typeof __initial_auth_token !== 'undefined') {
                // T√πy ch·ªçn n√†y ch·ªâ d√πng trong m√¥i tr∆∞·ªùng dev, kh√¥ng c·∫ßn cho GitHub Pages
            } else {
                signInAnonymously(auth);
            }

        } catch (e) {
            console.error("Firebase initialization error:", e);
        }

        // Functions for guestbook
        window.submitGuestbook = async () => {
            const name = document.getElementById('guest-name').value;
            const message = document.getElementById('guest-message').value;
            const formStatus = document.getElementById('form-status');

            if (!name || !message) {
                formStatus.textContent = 'Vui l√≤ng ƒëi·ªÅn t√™n v√† l·ªùi ch√∫c.';
                formStatus.className = 'text-red-500 mt-2';
                return;
            }

            try {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const date = `${year}-${month}-${day}`;

                const docRef = await addDoc(collection(db, `artifacts/${appId}/public/data/guestbook`), {
                    name,
                    message,
                    timestamp: date,
                    approved: true // L·ªùi ch√∫c m·ªõi s·∫Ω ƒë∆∞·ª£c duy·ªát ngay l·∫≠p t·ª©c
                });
                console.log("Document written with ID: ", docRef.id);
                document.getElementById('guest-name').value = '';
                document.getElementById('guest-message').value = '';
                formStatus.textContent = 'L·ªùi ch√∫c c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng!';
                formStatus.className = 'text-green-500 mt-2';
            } catch (e) {
                console.error("Error adding document: ", e);
                formStatus.textContent = 'C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.';
                formStatus.className = 'text-red-500 mt-2';
            }
        };

        // H√†m ƒë·ªÉ t·∫£i v√† hi·ªÉn th·ªã c√°c l·ªùi ch√∫c ƒë√£ ƒë∆∞·ª£c duy·ªát
        function loadGuestbook() {
            if (!db) return;
            const q = query(collection(db, `artifacts/${appId}/public/data/guestbook`), where("approved", "==", true));
            onSnapshot(q, (querySnapshot) => {
                const messages = [];
                querySnapshot.forEach((doc) => {
                    messages.push(doc.data());
                });

                // S·∫Øp x·∫øp tin nh·∫Øn theo timestamp (m·ªõi nh·∫•t l√™n ƒë·∫ßu)
                messages.sort((a, b) => b.timestamp.localeCompare(a.timestamp));
                
                const guestbookList = document.getElementById('guestbook-list');
                guestbookList.innerHTML = '';
                messages.forEach(msg => {
                    const li = document.createElement('li');
                    li.className = 'bg-stone-50 p-4 rounded-xl shadow-sm mb-4 border border-stone-200';
                    li.innerHTML = `
                        <p class="font-bold text-lg text-rose-500">${msg.name}</p>
                        <p class="text-stone-700 mt-2 italic">${msg.message}</p>
                        <p class="text-xs text-stone-500 mt-2 text-right">Ng√†y g·ª≠i: ${msg.timestamp}</p>
                    `;
                    guestbookList.appendChild(li);
                });
            });
        }
        
        // H√†m ƒë·ªÉ duy·ªát l·∫°i m·ªôt l·ªùi ch√∫c
        window.approveMessage = async (docId) => {
            try {
                const docRef = doc(db, `artifacts/${appId}/public/data/guestbook`, docId);
                await updateDoc(docRef, {
                    approved: true
                });
                console.log("Document successfully approved!");
            } catch (e) {
                console.error("Error approving document:", e);
            }
        };

        // H√†m ƒë·ªÉ ·∫©n m·ªôt l·ªùi ch√∫c
        window.hideMessage = async (docId) => {
            try {
                const docRef = doc(db, `artifacts/${appId}/public/data/guestbook`, docId);
                await updateDoc(docRef, {
                    approved: false
                });
                console.log("Document successfully hidden!");
            } catch (e) {
                console.error("Error hiding document:", e);
            }
        };

        function loadAdminPanel() {
            if (!db) return;
            const adminPanel = document.getElementById('admin-panel');
            adminPanel.style.display = 'block';

            // Load t·∫•t c·∫£ c√°c l·ªùi ch√∫c, kh√¥ng gi·ªõi h·∫°n
            const q = query(collection(db, `artifacts/${appId}/public/data/guestbook`));
            
            onSnapshot(q, (querySnapshot) => {
                const messages = [];
                querySnapshot.forEach((doc) => {
                    messages.push({ id: doc.id, ...doc.data() });
                });

                // S·∫Øp x·∫øp tin nh·∫Øn theo timestamp (m·ªõi nh·∫•t l√™n ƒë·∫ßu)
                messages.sort((a, b) => b.timestamp.localeCompare(a.timestamp));
                
                const pendingList = document.getElementById('pending-list');
                pendingList.innerHTML = '';
                messages.forEach(msg => {
                    const li = document.createElement('li');
                    li.className = `p-4 rounded-xl shadow-sm mb-4 border border-stone-200 ${msg.approved ? 'bg-green-100' : 'bg-red-100'}`;
                    li.innerHTML = `
                        <p class="font-bold text-lg text-stone-700">${msg.name}</p>
                        <p class="text-stone-600 mt-2 italic">${msg.message}</p>
                        <p class="text-xs text-stone-500 mt-2 text-right">Ng√†y g·ª≠i: ${msg.timestamp}</p>
                        <p class="text-xs font-bold mt-1 text-right">${msg.approved ? 'ƒê√£ duy·ªát' : 'ƒê√£ ·∫©n'}</p>
                        ${msg.approved ? `<button onclick="hideMessage('${msg.id}')" class="mt-2 w-full bg-red-500 text-white rounded-md py-1 font-semibold hover:bg-red-600">·∫®n</button>` : `<button onclick="approveMessage('${msg.id}')" class="mt-2 w-full bg-blue-500 text-white rounded-md py-1 font-semibold hover:bg-blue-600">Duy·ªát</button>`}
                    `;
                    pendingList.appendChild(li);
                });
            });
        }
    </script>
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f8f0e5;
            color: #4b5563; /* text-gray-600 */
            scroll-behavior: smooth;
        }
        .playfair-font {
            font-family: 'Playfair Display', serif;
        }
        .bg-cover-image {
            background-image: url('https://placehold.co/1200x800/e0c2a5/fff?text=·∫¢nh+c∆∞·ªõi+ƒë·∫πp');
            background-size: cover;
            background-position: center;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- Trang b√¨a -->
    <header id="home" class="h-screen bg-cover-image flex flex-col justify-center items-center text-center text-white p-4 relative">
        <div class="absolute inset-0 bg-black opacity-40"></div>
        <div class="relative z-10">
            <h1 class="playfair-font text-4xl sm:text-6xl md:text-8xl font-bold mb-4 animate-fadeIn">VƒÉn Ho√†n & Ng·ªçc Huy·ªÅn</h1>
            <p class="quicksand-font text-lg sm:text-xl md:text-2xl font-semibold mb-6 animate-fadeInDelay">Tr√¢n tr·ªçng k√≠nh m·ªùi <span id="guest-name-display" class="font-bold"></span></p>
            <p class="quicksand-font text-lg sm:text-xl md:text-2xl animate-fadeInDelay">Th·ª© B·∫£y, ng√†y 10 th√°ng 10 nƒÉm 2025</p>
        </div>
        <a href="#details" class="absolute bottom-10 animate-bounce cursor-pointer">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
        </a>
    </header>

    <!-- Chi ti·∫øt s·ª± ki·ªán -->
    <section id="details" class="py-16 px-4 bg-white text-center">
        <h2 class="playfair-font text-3xl font-bold text-rose-500 mb-8">Chi Ti·∫øt S·ª± Ki·ªán</h2>
        <div class="max-w-3xl mx-auto space-y-8 md:space-y-0 md:flex md:gap-8">
            <div class="flex-1 bg-stone-50 p-6 rounded-3xl shadow-lg border border-stone-200">
                <h3 class="playfair-font text-2xl font-semibold text-stone-700 mb-4">L·ªÖ Th√†nh H√¥n</h3>
                <p class="quicksand-font text-lg font-semibold mb-2 text-rose-500">T·∫°i nh√† trai</p>
                <p class="mb-1">‚è∞ Th·ªùi gian: <span class="font-semibold">09:00</span></p>
                <p class="mb-1">üìÖ Ng√†y: <span class="font-semibold">Th·ª© B·∫£y, ng√†y 10/10/2025</span></p>
                <p>üìç ƒê·ªãa ƒëi·ªÉm: <a href="https://maps.app.goo.gl/placeholder1" target="_blank" class="font-semibold text-blue-600 hover:underline">Nh√† ri√™ng ch√∫ r·ªÉ</a></p>
            </div>
            <div class="flex-1 bg-stone-50 p-6 rounded-3xl shadow-lg border border-stone-200">
                <h3 class="playfair-font text-2xl font-semibold text-stone-700 mb-4">Ti·ªác C∆∞·ªõi</h3>
                <p class="quicksand-font text-lg font-semibold mb-2 text-rose-500">T·∫°i nh√† h√†ng</p>
                <p class="mb-1">‚è∞ Th·ªùi gian: <span class="font-semibold">18:00</span></p>
                <p class="mb-1">üìÖ Ng√†y: <span class="font-semibold">Th·ª© B·∫£y, ng√†y 10/10/2025</span></p>
                <p>üìç ƒê·ªãa ƒëi·ªÉm: <a href="https://maps.app.goo.gl/placeholder2" target="_blank" class="font-semibold text-blue-600 hover:underline">Nh√† H√†ng ABC, 123 ƒê∆∞·ªùng XYZ, TP. HCM</a></p>
            </div>
        </div>
    </section>

    <!-- C√¢u chuy·ªán t√¨nh y√™u -->
    <section id="story" class="py-16 px-4 bg-rose-50 text-center">
        <h2 class="playfair-font text-3xl font-bold text-rose-500 mb-8">C√¢u Chuy·ªán C·ªßa Ch√∫ng T√¥i</h2>
        <div class="max-w-4xl mx-auto">
            <div class="md:flex md:items-center md:gap-8 mb-8">
                <div class="md:w-1/2 mb-4 md:mb-0">
                    <img src="https://placehold.co/600x400/fff3d6/e0c2a5?text=·∫¢nh+k·ª∑+ni·ªám+1" alt="Our story photo 1" class="rounded-3xl shadow-lg w-full">
                </div>
                <div class="md:w-1/2 text-left">
                    <h3 class="playfair-font text-xl font-semibold text-stone-700 mb-2">L·∫ßn ƒë·∫ßu g·∫∑p g·ª°...</h3>
                    <p class="text-sm text-stone-600 leading-relaxed">C√¢u chuy·ªán t√¨nh y√™u c·ªßa ch√∫ng t√¥i b·∫Øt ƒë·∫ßu t·ª´ m·ªôt bu·ªïi g·∫∑p g·ª° t√¨nh c·ªù. √Ånh m·∫Øt ƒë·∫ßu ti√™n, n·ª• c∆∞·ªùi ƒë·∫ßu ti√™n... ƒë·ªÅu l√† nh·ªØng kho·∫£nh kh·∫Øc ƒë√°ng nh·ªõ, l√† ƒëi·ªÉm kh·ªüi ƒë·∫ßu cho m·ªôt h√†nh tr√¨nh d√†i ƒë·∫ßy ·∫Øp k·ª∑ ni·ªám.</p>
                </div>
            </div>
            <div class="md:flex md:flex-row-reverse md:items-center md:gap-8">
                <div class="md:w-1/2 mb-4 md:mb-0">
                    <img src="https://placehold.co/600x400/fff3d6/e0c2a5?text=·∫¢nh+k·ª∑+ni·ªám+2" alt="Our story photo 2" class="rounded-3xl shadow-lg w-full">
                </div>
                <div class="md:w-1/2 text-left">
                    <h3 class="playfair-font text-xl font-semibold text-stone-700 mb-2">H√†nh tr√¨nh y√™u th∆∞∆°ng...</h3>
                    <p class="text-sm text-stone-600 leading-relaxed">Ch√∫ng t√¥i ƒë√£ c√πng nhau v∆∞·ª£t qua bao th·ª≠ th√°ch, chia s·∫ª ni·ªÅm vui v√† c·∫£ nh·ªØng n·ªói bu·ªìn. M·ªói kho·∫£nh kh·∫Øc ƒë·ªÅu tr·ªü th√†nh m·ªôt ph·∫ßn c·ªßa c√¢u chuy·ªán, m·ªôt vi√™n g·∫°ch x√¢y n√™n ng√¥i nh√† h·∫°nh ph√∫c c·ªßa ch√∫ng t√¥i.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- B·ªô s∆∞u t·∫≠p ·∫£nh -->
    <section id="gallery" class="py-16 px-4 bg-white text-center">
        <h2 class="playfair-font text-3xl font-bold text-rose-500 mb-8">Album ·∫¢nh C∆∞·ªõi</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 max-w-6xl mx-auto">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+1" alt="Gallery photo 1" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+2" alt="Gallery photo 2" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+3" alt="Gallery photo 3" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+4" alt="Gallery photo 4" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+5" alt="Gallery photo 5" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+6" alt="Gallery photo 6" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+7" alt="Gallery photo 7" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+8" alt="Gallery photo 8" class="w-full h-auto rounded-xl shadow-md">
        </div>
    </section>

    <!-- S·ªï l∆∞u b√∫t -->
    <section id="guestbook" class="py-16 px-4 bg-rose-50 text-center">
        <h2 class="playfair-font text-3xl font-bold text-rose-500 mb-8">S·ªï L∆∞u B√∫t & L·ªùi Ch√∫c</h2>
        <div class="max-w-2xl mx-auto">
            <!-- Form g·ª≠i l·ªùi ch√∫c -->
            <div class="bg-white p-6 rounded-3xl shadow-lg border border-stone-200 mb-8">
                <form onsubmit="event.preventDefault(); submitGuestbook();">
                    <div class="mb-4">
                        <label for="guest-name" class="block text-sm font-medium text-gray-700 text-left mb-1">T√™n c·ªßa b·∫°n:</label>
                        <input type="text" id="guest-name" class="block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                    </div>
                    <div class="mb-4">
                        <label for="guest-message" class="block text-sm font-medium text-gray-700 text-left mb-1">L·ªùi ch√∫c:</label>
                        <textarea id="guest-message" rows="4" class="block w-full rounded-md border-gray-300 shadow-sm p-2 border" required></textarea>
                    </div>
                    <button type="submit" class="w-full bg-rose-500 text-white rounded-md py-2 font-semibold hover:bg-rose-600 transition-colors">G·ª≠i L·ªùi Ch√∫c</button>
                    <p id="form-status" class="text-sm mt-2"></p>
                </form>
            </div>
            
            <!-- Danh s√°ch l·ªùi ch√∫c -->
            <ul id="guestbook-list" class="text-left mt-8">
                <!-- L·ªùi ch√∫c s·∫Ω ƒë∆∞·ª£c load t·∫°i ƒë√¢y -->
            </ul>
        </div>
        <p class="text-sm text-stone-400 mt-8">User ID c·ªßa b·∫°n: <span id="user-id">ƒêang t·∫£i...</span></p>
    </section>

    <!-- Admin Panel (m·∫∑c ƒë·ªãnh ·∫©n) -->
    <section id="admin-panel" class="py-16 px-4 bg-white text-center hidden">
        <hr class="mb-8 border-t-2 border-stone-300"/>
        <h2 class="playfair-font text-3xl font-bold text-stone-700 mb-8">Trang Qu·∫£n L√Ω L·ªùi Ch√∫c</h2>
        <p class="text-stone-600 mb-4">C√°c l·ªùi ch√∫c ƒë√£ duy·ªát v√† b·ªã ·∫©n:</p>
        <div class="max-w-2xl mx-auto">
            <ul id="pending-list" class="text-left">
                <!-- Danh s√°ch l·ªùi ch√∫c ch·ªù duy·ªát s·∫Ω ƒë∆∞·ª£c load t·∫°i ƒë√¢y -->
            </ul>
        </div>
    </section>


    <!-- Ch√¢n trang -->
    <footer class="bg-stone-900 text-white py-8 text-center">
        <p class="text-sm">Copyright ¬© <span id="current-year"></span> VƒÉn Ho√†n & Ng·ªçc Huy·ªÅn. All Rights Reserved.</p>
        <p class="text-xs text-stone-400 mt-2">ƒê∆∞·ª£c t·∫°o b·ªüi Gemini.</p>
    </footer>

    <script>
        document.getElementById('current-year').textContent = new Date().getFullYear();
    </script>
</body>
</html>
