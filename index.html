<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Thi·ªáp M·ªôc N√¢u ‚Ä¢ Ho√†n & Huy·ªÅn</title>
  <meta name="description" content="Thi·ªáp c∆∞·ªõi online phong c√°ch m·ªôc n√¢u c·ªßa VƒÉn Ho√†n & Ng·ªçc Huy·ªÅn" />
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Italiana&family=Quicksand:wght@400;600;700&family=Great+Vibes&display=swap" rel="stylesheet">
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            serif: ['Playfair Display','serif'],
            display: ['Italiana','serif'],
            sans: ['Quicksand','system-ui','sans-serif'],
            script: ['Great Vibes','cursive']
          },
          colors: {
            coffee:{50:'#f7f1ea',100:'#efe3d5',200:'#e6d5c3',300:'#dcc3a9',400:'#cfae90',500:'#b89473',600:'#8b5e3c',700:'#734a2b',800:'#5b3b22',900:'#45301d'},
            burg:'#7e1f24', gold:'#e1c285', rosey:'#d4a373'
          },
          backgroundImage:{
            hero:"url('https://images.unsplash.com/photo-1519741497674-611481863552?q=80&w=1470&auto=format&fit=crop')",
            paperTex:"url('data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2248%22 height=%2248%22 viewBox=%220 0 48 48%22><filter id=%22n%22><feTurbulence type=%22fractalNoise%22 baseFrequency=%220.8%22 numOctaves=%222%22 stitchTiles=%22stitch%22/><feColorMatrix type=%22saturate%22 values=%220%22/><feComponentTransfer><feFuncA type=%22table%22 tableValues=%220 0 .04 .07%22/></feComponentTransfer></filter><rect width=%2248%22 height=%2248%22 filter=%22url(%23n)%22/></svg>')"
          },
          boxShadow:{frame:'0 10px 30px rgba(0,0,0,.08)'}
        }
      }
    }
  </script>
  <style>
    html,body{scroll-behavior:smooth}
    .section-frame{
      background:linear-gradient(#fff,#fff) padding-box,
                 linear-gradient(135deg,rgba(139,94,60,.25),rgba(212,163,115,.25)) border-box;
      border:1px solid transparent;border-radius:22px;box-shadow:0 12px 30px rgba(0,0,0,.06);
    }
    .divider{height:1px;background:linear-gradient(90deg,transparent,#e0d3c2,transparent)}
    .reveal{opacity:0;transform:translateY(16px);transition:opacity .6s ease,transform .6s ease}
    .reveal.show{opacity:1;transform:none}

    /* ===== ENVELOPE COVER ===== */
    #cover{position:fixed;inset:0;z-index:70;pointer-events:auto;background:#7e1f24}
    #cover .side{position:absolute;top:0;bottom:0;width:50%;background:#7e1f24;
      transition:transform 2.2s cubic-bezier(.17,.84,.26,1)}
    #cover .left{left:0;border-right:2px solid rgba(225,194,133,.8)}
    #cover .right{right:0;border-left:2px solid rgba(225,194,133,.8)}
    #cover.opened .left{transform:translateX(-100%)}
    #cover.opened .right{transform:translateX(100%)}
    #cover .card{
      position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
      width:min(88vw,420px);height:min(86vh,760px);
      border:3px solid #e1c285;border-radius:10px;overflow:hidden;background:#f8f4ef;
      box-shadow:0 30px 80px rgba(0,0,0,.35);
      transition:opacity .75s .8s,transform .8s .75s;display:grid;place-items:center
    }
    #cover .card-inner{position:relative;width:100%;height:100%;
      background-image:var(--invite-image, url('https://images.unsplash.com/photo-1520614073990-dd602f64d05d?q=80&w=1260&auto=format&fit=crop'));
      background-size:cover;background-position:center;filter:contrast(.95) brightness(.95)
    }
    #cover .seal{position:absolute;left:50%;bottom:28%;transform:translate(-50%,50%);
      width:120px;height:120px;border-radius:999px;background:radial-gradient(60% 60% at 30% 30%,#cc8b5a,#8a5630 70%);
      border:4px solid #caa36e;box-shadow:inset 0 8px 18px rgba(255,255,255,.25),inset 0 -8px 18px rgba(0,0,0,.28),0 12px 26px rgba(0,0,0,.45)
    }
    #cover .seal-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:999px;opacity:.92;mix-blend-mode:multiply}
    #cover.opened .card{opacity:0;transform:translate(-50%,-52%) scale(.96)}
    #cover .hint{position:absolute;left:50%;bottom:20px;transform:translateX(-50%);color:#fff;background:rgba(0,0,0,.18);padding:.4rem .8rem;border-radius:12px;font-size:.9rem;letter-spacing:.06em}

    /* ===== LIGHTBOX ===== */
    .lb-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;z-index:60}
    .lb-backdrop.active{display:flex}
    .lb-img{max-width:92vw;max-height:82vh;border-radius:18px;box-shadow:0 20px 60px rgba(0,0,0,.35)}
    .lb-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.85);border-radius:999px;width:42px;height:42px;display:grid;place-items:center}
    .lb-prev{left:18px}.lb-next{right:18px}
    .lb-close{position:absolute;top:14px;right:14px;background:rgba(255,255,255,.9);width:38px;height:38px;border-radius:999px;display:grid;place-items:center}
  </style>
</head>
<body class="bg-coffee-50 bg-paperTex/30 text-coffee-900 font-sans antialiased">

  <!-- ===== ENVELOPE (overlays everything, then bi·∫øn m·∫•t) ===== -->
  <div id="cover" class="select-none">
    <div class="side left"></div>
    <div class="side right"></div>
    <div class="card">
      <div class="card-inner"></div>
      <div class="seal"><img id="seal-img" class="seal-img" alt="Wax seal"></div>
    </div>
    <div class="hint">Thi·ªáp s·∫Ω m·ªü t·ª± ƒë·ªông ‚Ä¢ ch·∫°m ƒë·ªÉ m·ªü ngay</div>
  </div>

  <!-- ===== MUSIC: auto play + mute toggle ===== -->
  <button id="music-btn" class="fixed bottom-4 right-4 z-50 rounded-full bg-coffee-900 text-white w-12 h-12 grid place-items-center shadow-lg opacity-90 hover:opacity-100" aria-label="T·∫Øt/B·∫≠t ti·∫øng">
    <svg id="icon-sound-on"  xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M3 10v4h4l5 5V5L7 10H3zM16.5 12a4.5 4.5 0 01-2.12 3.84l1.06 1.82A6.5 6.5 0 0018.5 12a6.5 6.5 0 00-3.06-5.66l-1.06 1.82A4.5 4.5 0 0116.5 12z"/></svg>
    <svg id="icon-sound-off" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 hidden" viewBox="0 0 24 24" fill="currentColor"><path d="M16.5 12a4.5 4.5 0 01-2.12 3.84l1.06 1.82A6.5 6.5 0 0018.5 12a6.5 6.5 0 00-3.06-5.66l-1.06 1.82A4.5 4.5 0 0116.5 12z"/><path d="M3 10v4h4l5 5V5L7 10H3zM19 8l-2 2m0 4l2 2"/></svg>
  </button>
  <audio id="bgm" preload="auto" playsinline></audio>

  <!-- ===== HERO ===== -->
  <header id="home" class="relative min-h-[88svh] grid place-items-center overflow-hidden">
    <div class="absolute inset-0 bg-hero bg-cover bg-center will-change-transform" id="hero-bg"></div>
    <div class="absolute inset-0 bg-coffee-900/55"></div>
    <div class="relative z-10 text-center px-6 py-24">
      <p class="font-script text-4xl sm:text-5xl text-white/90 reveal">Thi·ªáp M·ªùi</p>
      <h1 class="font-display tracking-widest text-white text-5xl sm:text-7xl md:text-8xl mt-2 reveal">VƒÇN HO√ÄN</h1>
      <p class="text-4xl md:text-5xl font-script text-rosey -mt-2 md:-mt-3 reveal">&</p>
      <h2 class="font-display tracking-widest text-white text-4xl sm:text-6xl md:text-7xl reveal">NG·ªåC HUY·ªÄN</h2>
      <p id="guest-line" class="mt-5 text-white/95 reveal">Tr√¢n tr·ªçng k√≠nh m·ªùi <span id="guest-name-display" class="font-semibold"></span></p>
      <div class="mt-8 inline-flex gap-3 reveal">
        <a href="#timeline" class="px-5 py-2 rounded-full bg-white/90 hover:bg-white text-coffee-900 font-semibold shadow-md">Xem l·ªãch</a>
        <a href="#guestbook" class="px-5 py-2 rounded-full border border-white/70 text-white/95 hover:bg-white/10">G·ª≠i l·ªùi ch√∫c</a>
      </div>
    </div>
  </header>

  <!-- ===== NAV ===== -->
  <nav class="sticky top-0 z-40 bg-white/85 backdrop-blur border-b border-coffee-200">
    <div class="max-w-6xl mx-auto px-4 py-2 flex items-center gap-6 text-sm">
      <a href="#timeline" class="hover:text-coffee-700">L·ªãch tr√¨nh</a>
      <a href="#countdown" class="hover:text-coffee-700">ƒê·∫øm ng∆∞·ª£c</a>
      <a href="#gallery" class="hover:text-coffee-700">Album</a>
      <a href="#guestbook" class="hover:text-coffee-700">S·ªï l∆∞u b√∫t</a>
      <a href="#qr" class="hover:text-coffee-700">QR</a>
      <span class="ml-auto text-coffee-700/80">10.10.2025</span>
    </div>
  </nav>

  <!-- ===== TIMELINE ===== -->
  <section id="timeline" class="max-w-5xl mx-auto px-4 py-14">
    <h3 class="font-serif text-3xl font-bold text-center text-coffee-700 reveal">L·ªãch tr√¨nh ng√†y c∆∞·ªõi</h3>
    <div class="mt-10 relative">
      <div class="absolute left-1/2 -translate-x-1/2 top-0 bottom-0 w-[2px] bg-coffee-300 hidden md:block"></div>
      <div class="md:grid md:grid-cols-2 items-center gap-8 mb-10">
        <div class="md:text-right md:pr-10">
          <div class="inline-block section-frame px-5 py-4 reveal">
            <p class="uppercase tracking-widest text-coffee-600 text-xs">L·ªÖ Th√†nh H√¥n</p>
            <p class="font-serif text-2xl font-bold text-coffee-800">09:00 ‚Äî 10/10/2025</p>
            <p class="text-coffee-800/90">T·∫°i nh√† trai</p>
            <a class="inline-block mt-2 text-rosey font-semibold hover:underline" target="_blank" href="https://maps.google.com">Xem b·∫£n ƒë·ªì</a>
          </div>
        </div>
        <div class="relative hidden md:block">
          <div class="absolute left-1/2 -translate-x-1/2 w-4 h-4 rounded-full bg-coffee-600 border-4 border-coffee-100"></div>
        </div>
      </div>
      <div class="md:grid md:grid-cols-2 items-center gap-8 mb-10">
        <div class="relative order-2 md:order-1 hidden md:block">
          <div class="absolute left-1/2 -translate-x-1/2 w-4 h-4 rounded-full bg-coffee-600 border-4 border-coffee-100"></div>
        </div>
        <div class="md:pl-10 order-1 md:order-2">
          <div class="inline-block section-frame px-5 py-4 reveal">
            <p class="uppercase tracking-widest text-coffee-600 text-xs">Ti·ªác C∆∞·ªõi</p>
            <p class="font-serif text-2xl font-bold text-coffee-800">18:00 ‚Äî 10/10/2025</p>
            <p class="text-coffee-800/90">Nh√† h√†ng ABC</p>
            <a class="inline-block mt-2 text-rosey font-semibold hover:underline" target="_blank" href="https://maps.google.com">Xem b·∫£n ƒë·ªì</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== COUNTDOWN ===== -->
  <section id="countdown" class="bg-white/70">
    <div class="max-w-6xl mx-auto px-4 py-14 text-center">
      <h3 class="font-serif text-3xl font-bold text-coffee-700 reveal">ƒê·∫øm ng∆∞·ª£c t·ªõi ng√†y vui</h3>
      <div id="counter" class="mt-6 grid grid-cols-2 sm:grid-cols-4 gap-3 max-w-3xl mx-auto">
        <div class="section-frame py-6 reveal"><div id="days"  class="text-4xl font-serif font-bold"></div><div class="text-xs mt-1">Ng√†y</div></div>
        <div class="section-frame py-6 reveal"><div id="hours" class="text-4xl font-serif font-bold"></div><div class="text-xs mt-1">Gi·ªù</div></div>
        <div class="section-frame py-6 reveal"><div id="mins"  class="text-4xl font-serif font-bold"></div><div class="text-xs mt-1">Ph√∫t</div></div>
        <div class="section-frame py-6 reveal"><div id="secs"  class="text-4xl font-serif font-bold"></div><div class="text-xs mt-1">Gi√¢y</div></div>
      </div>
    </div>
  </section>

  <!-- ===== STORY ===== -->
  <section class="max-w-6xl mx-auto px-4 py-14">
    <div class="section-frame overflow-hidden reveal">
      <img src="https://images.unsplash.com/photo-1519741229575-3b66ef1cb8a0?q=80&w=1480&auto=format&fit=crop" alt="Couple banner" class="w-full h-[320px] object-cover">
      <div class="p-6 md:p-8 grid md:grid-cols-2 gap-6 items-center">
        <div class="reveal">
          <h3 class="font-serif text-2xl font-bold text-coffee-700">C√¢u chuy·ªán c·ªßa ch√∫ng t√¥i</h3>
          <p class="mt-2 text-coffee-800/90 leading-relaxed">Ch√∫ng t√¥i g·∫∑p nhau trong m·ªôt chi·ªÅu m√πa thu ·∫•m √°p... v√† h√†nh tr√¨nh y√™u th∆∞∆°ng c·ª© th·∫ø ti·∫øp n·ªëi b·∫±ng nh·ªØng ƒëi·ªÅu gi·∫£n d·ªã.</p>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <img class="rounded-xl shadow reveal" src="https://placehold.co/600x400/e7d7c6/5b3b22?text=Kho·∫£nh+kh·∫Øc+1" alt="">
          <img class="rounded-xl shadow reveal" src="https://placehold.co/600x400/e7d7c6/5b3b22?text=Kho·∫£nh+kh·∫Øc+2" alt="">
          <img class="rounded-xl shadow reveal" src="https://placehold.co/600x400/e7d7c6/5b3b22?text=Kho·∫£nh+kh·∫Øc+3" alt="">
          <img class="rounded-xl shadow reveal" src="https://placehold.co/600x400/e7d7c6/5b3b22?text=Kho·∫£nh+kh·∫Øc+4" alt="">
        </div>
      </div>
    </div>
  </section>

  <!-- ===== GALLERY (Lightbox) ===== -->
  <section id="gallery" class="bg-white/70">
    <div class="max-w-6xl mx-auto px-4 py-14">
      <h3 class="font-serif text-3xl font-bold text-center text-coffee-700 reveal">Album ·∫£nh c∆∞·ªõi</h3>
      <div id="gallery-grid" class="mt-8 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        <img src="thiep-cuoi/image/95H03597" data-full="thiep-cuoi/image/95H03597" class="rounded-xl shadow-frame object-cover w-full h-72 cursor-zoom-in reveal" alt="">
        <img src="https://placehold.co/800x1000/ede3d7/8b5e3c?text=·∫¢nh+2" data-full="https://placehold.co/1600x2000/ede3d7/5b3b22?text=·∫¢nh+2" class="rounded-xl shadow-frame object-cover w-full h-72 cursor-zoom-in reveal" alt="">
        <img src="https://placehold.co/800x1000/ede3d7/8b5e3c?text=·∫¢nh+3" data-full="https://placehold.co/1600x2000/ede3d7/5b3b22?text=·∫¢nh+3" class="rounded-xl shadow-frame object-cover w-full h-72 cursor-zoom-in reveal" alt="">
        <img src="https://placehold.co/800x1000/ede3d7/8b5e3c?text=·∫¢nh+4" data-full="https://placehold.co/1600x2000/ede3d7/5b3b22?text=·∫¢nh+4" class="rounded-xl shadow-frame object-cover w-full h-72 cursor-zoom-in reveal" alt="">
        <img src="https://placehold.co/800x1000/ede3d7/8b5e3c?text=·∫¢nh+5" data-full="https://placehold.co/1600x2000/ede3d7/5b3b22?text=·∫¢nh+5" class="rounded-xl shadow-frame object-cover w-full h-72 cursor-zoom-in reveal" alt="">
        <img src="https://placehold.co/800x1000/ede3d7/8b5e3c?text=·∫¢nh+6" data-full="https://placehold.co/1600x2000/ede3d7/5b3b22?text=·∫¢nh+6" class="rounded-xl shadow-frame object-cover w-full h-72 cursor-zoom-in reveal" alt="">
        <img src="https://placehold.co/800x1000/ede3d7/8b5e3c?text=·∫¢nh+7" data-full="https://placehold.co/1600x2000/ede3d7/5b3b22?text=·∫¢nh+7" class="rounded-xl shadow-frame object-cover w-full h-72 cursor-zoom-in reveal" alt="">
        <img src="https://placehold.co/800x1000/ede3d7/8b5e3c?text=·∫¢nh+8" data-full="https://placehold.co/1600x2000/ede3d7/5b3b22?text=·∫¢nh+8" class="rounded-xl shadow-frame object-cover w-full h-72 cursor-zoom-in reveal" alt="">
      </div>
    </div>
  </section>

  <!-- ===== GUESTBOOK (Firestore) ===== -->
  <section id="guestbook" class="max-w-6xl mx-auto px-4 py-14">
    <div class="grid md:grid-cols-2 gap-6">
      <div class="section-frame p-6 reveal">
        <h3 class="font-serif text-2xl font-bold text-coffee-700">S·ªï l∆∞u b√∫t & l·ªùi ch√∫c</h3>
        <form class="mt-4" onsubmit="event.preventDefault(); submitGuestbook();">
          <label class="text-sm">T√™n c·ªßa b·∫°n</label>
          <input id="guest-name" class="mt-1 w-full rounded-lg border border-coffee-200 focus:outline-none focus:ring-2 focus:ring-rosey/60 p-2.5" required />
          <label class="text-sm block mt-3">L·ªùi ch√∫c</label>
          <textarea id="guest-message" rows="4" class="mt-1 w-full rounded-lg border border-coffee-200 focus:outline-none focus:ring-2 focus:ring-rosey/60 p-2.5" required></textarea>
          <button class="mt-3 w-full rounded-lg bg-coffee-600 hover:bg-coffee-700 text-white font-semibold py-2.5">G·ª≠i l·ªùi ch√∫c</button>
          <p id="form-status" class="text-sm mt-2"></p>
        </form>
        <p class="text-xs text-coffee-500 mt-4">User ID: <span id="user-id">N/A</span></p>
      </div>

      <div class="section-frame p-0 overflow-hidden reveal">
        <div class="px-6 pt-6">
          <h4 class="font-serif text-xl font-bold text-coffee-700">L·ªùi ch√∫c t·ª´ b·∫°n b√®</h4>
          <p class="text-sm text-coffee-700/80">C√°c l·ªùi ch√∫c m·ªõi nh·∫•t s·∫Ω hi·ªán l√™n ngay t·∫°i ƒë√¢y üíå</p>
        </div>
        <div class="divider my-4"></div>
        <ul id="guestbook-list" class="px-6 pb-6 max-h-[520px] overflow-auto"></ul>
      </div>
    </div>
  </section>

  <!-- ===== QR ===== -->
  <section id="qr" class="bg-white/70">
    <div class="max-w-6xl mx-auto px-4 py-14">
      <h3 class="font-serif text-3xl font-bold text-center text-coffee-700 reveal">QR ti·ªán d·ª•ng</h3>
      <div class="mt-8 grid sm:grid-cols-2 gap-6">
        <div class="section-frame p-6 text-center reveal">
          <h4 class="font-serif text-xl font-semibold text-coffee-800">ƒê·ªãa ƒëi·ªÉm</h4>
          <p class="text-sm text-coffee-700/80">Qu√©t ƒë·ªÉ m·ªü Google Maps</p>
          <img class="mx-auto my-4 w-44 h-44" alt="QR b·∫£n ƒë·ªì"
               src="https://chart.googleapis.com/chart?cht=qr&chs=240x240&chl=https%3A%2F%2Fmaps.google.com%2F" />
          <a target="_blank" href="https://maps.google.com" class="inline-block px-4 py-2 rounded-md bg-coffee-900 text-white hover:bg-coffee-800">M·ªü b·∫£n ƒë·ªì</a>
        </div>
        <div class="section-frame p-6 text-center reveal">
          <h4 class="font-serif text-xl font-semibold text-coffee-800">Chia s·∫ª thi·ªáp</h4>
          <p class="text-sm text-coffee-700/80">Qu√©t ƒë·ªÉ m·ªü thi·ªáp n√†y</p>
          <img class="mx-auto my-4 w-44 h-44" alt="QR thi·ªáp"
               src="https://chart.googleapis.com/chart?cht=qr&chs=240x240&chl=https%3A%2F%2Fhoan-do.github.io%2Fthiep-cuoi%2F" />
          <a target="_blank" href="https://hoan-do.github.io/thiep-cuoi/" class="inline-block px-4 py-2 rounded-md bg-coffee-900 text-white hover:bg-coffee-800">M·ªü thi·ªáp</a>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== ADMIN BAR / LOGIN / PANEL (gi·ªØ nguy√™n logic ·∫©n/hi·ªán) ===== -->
  <div id="admin-bar" class="hidden fixed top-0 left-0 right-0 bg-coffee-900 text-white text-sm px-3 py-2 flex items-center justify-between z-50">
    <span id="admin-info">Ch·∫ø ƒë·ªô qu·∫£n tr·ªã</span>
    <div class="flex items-center gap-2">
      <button id="btn-resend" class="text-xs bg-white/20 rounded px-2 py-1 hover:bg-white/30">G·ª≠i l·∫°i email x√°c minh</button>
      <button id="btn-refresh" class="text-xs bg-white/20 rounded px-2 py-1 hover:bg-white/30">T√¥i ƒë√£ x√°c minh</button>
      <button id="btn-logout" class="text-xs bg-white/20 rounded px-2 py-1 hover:bg-white/30">ƒêƒÉng xu·∫•t</button>
    </div>
  </div>

  <section id="admin-login-box" class="hidden max-w-2xl mx-auto px-4 py-10">
    <div class="section-frame p-6">
      <h3 class="font-serif text-2xl font-bold text-coffee-700 text-center">ƒêƒÉng nh·∫≠p admin</h3>
      <form id="admin-login-form" class="max-w-md mx-auto mt-4">
        <label class="text-sm">Email</label>
        <input id="admin-email" type="email" class="mt-1 w-full rounded-lg border border-coffee-200 p-2.5" placeholder="ban@domain.com" required />
        <label class="text-sm block mt-3">M·∫≠t kh·∫©u</label>
        <input id="admin-password" type="password" class="mt-1 w-full rounded-lg border border-coffee-200 p-2.5" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
        <button class="mt-4 w-full rounded-lg bg-coffee-900 text-white font-semibold py-2.5">ƒêƒÉng nh·∫≠p</button>
        <p id="admin-login-msg" class="text-sm mt-2 text-center"></p>
      </form>
    </div>
  </section>

  <section id="admin-panel" class="hidden max-w-6xl mx-auto px-4 py-8">
    <div class="section-frame p-6">
      <h3 class="font-serif text-2xl font-bold text-coffee-700 text-center">Trang qu·∫£n l√Ω l·ªùi ch√∫c</h3>
      <p class="text-center text-sm text-coffee-700/80">·∫®n/hi·ªán b·∫•t k·ª≥ l·ªùi ch√∫c n√†o (c·∫ßn Rules cho ph√©p c·∫≠p nh·∫≠t)</p>
      <ul id="pending-list" class="mt-6 grid gap-3"></ul>
    </div>
  </section>

  <footer class="bg-coffee-900 text-white text-center py-8 mt-10">
    <p>&copy; <span id="current-year"></span> VƒÉn Ho√†n & Ng·ªçc Huy·ªÅn. All rights reserved.</p>
  </footer>

  <!-- ===== APP SCRIPT ===== -->
  <script type="module">
    /* ---------- Firebase ---------- */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBA68TNBDx4T23PfkZTcU1RwWmDeQUgY",
      authDomain: "thiep-cuoi-c3d08.firebaseapp.com",
      projectId: "thiep-cuoi-c3d08",
      storageBucket: "thiep-cuoi-c3d08.appspot.com",
      messagingSenderId: "221614290",
      appId: "1:221614290:web:a3db7a9973261b9b3a0d8b"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    /* ---------- Guest name in hero ---------- */
    const params = new URLSearchParams(location.search);
    const nameTo = params.get("to");
    if (nameTo) { const el=document.getElementById('guest-name-display'); if(el) el.textContent=decodeURIComponent(nameTo); }
    else { const l=document.getElementById('guest-line'); if(l) l.classList.add('hidden'); }

    /* ---------- Guestbook submit ---------- */
    window.submitGuestbook = async () => {
      const name=(document.getElementById('guest-name').value||'').trim();
      const message=(document.getElementById('guest-message').value||'').trim();
      const status=document.getElementById('form-status');
      if(!name||!message){ status.textContent="Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin."; status.className="text-red-600 mt-2"; return; }
      try{
        await addDoc(collection(db,'guestbook'),{name,message,createdAt:serverTimestamp(),hidden:false});
        document.getElementById('guest-name').value=""; document.getElementById('guest-message').value="";
        status.textContent="ƒê√£ g·ª≠i l·ªùi ch√∫c th√†nh c√¥ng!"; status.className="text-green-600 mt-2";
      }catch(e){ console.error(e); status.textContent="G·ª≠i th·∫•t b·∫°i, vui l√≤ng th·ª≠ l·∫°i."; status.className="text-red-600 mt-2"; }
    };

    /* ---------- Public render ---------- */
    const qPublic=query(collection(db,'guestbook'),orderBy('createdAt','desc'));
    onSnapshot(qPublic,(snap)=>{
      const list=document.getElementById('guestbook-list'); if(!list) return; list.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data(); if(d.hidden===true) return;
        const li=document.createElement('li'); li.className="mb-3 p-4 rounded-xl border border-coffee-200 bg-white/80 shadow-sm";
        const when=d.createdAt?.toDate?d.createdAt.toDate().toLocaleString('vi-VN'):"";
        li.innerHTML=`<p class="font-semibold text-coffee-800">${d.name||''}</p>
                      <p class="text-coffee-700/90 mt-1">${d.message||''}</p>
                      <p class="text-xs text-coffee-600/70 mt-2 text-right">${when}</p>`;
        list.appendChild(li);
      });
    });

    /* ---------- Admin mode ---------- */
    const isAdmin=params.get('admin')==='true';
    if(isAdmin){
      const { getAuth,onAuthStateChanged,signInWithEmailAndPassword,signOut,getIdToken,sendEmailVerification,reload } =
        await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js");
      const auth=getAuth(app);
      const loginBox=document.getElementById('admin-login-box');
      const adminBar=document.getElementById('admin-bar');
      const adminPanel=document.getElementById('admin-panel');
      const info=document.getElementById('admin-info');
      const uidPlace=document.getElementById('user-id');

      document.getElementById('admin-login-form').addEventListener('submit',async(e)=>{
        e.preventDefault();
        const email=document.getElementById('admin-email').value.trim();
        const pass=document.getElementById('admin-password').value;
        const msg=document.getElementById('admin-login-msg');
        msg.textContent="ƒêang ƒëƒÉng nh·∫≠p...";
        try{ await signInWithEmailAndPassword(auth,email,pass); msg.textContent=""; }
        catch(err){ console.error(err); msg.textContent="ƒêƒÉng nh·∫≠p th·∫•t b·∫°i. Ki·ªÉm tra email/m·∫≠t kh·∫©u."; msg.className="text-red-600 mt-2 text-center"; }
      });
      document.getElementById('btn-logout').addEventListener('click',()=>signOut(auth));
      document.getElementById('btn-resend').addEventListener('click',async()=>{ if(!auth.currentUser) return; await sendEmailVerification(auth.currentUser); alert("ƒê√£ g·ª≠i email x√°c minh."); });
      document.getElementById('btn-refresh').addEventListener('click',async()=>{ if(!auth.currentUser) return; await reload(auth.currentUser); await getIdToken(auth.currentUser,true); updateUI(auth.currentUser); });

      function updateUI(user){
        if(user){ uidPlace.textContent=user.uid; adminBar.classList.remove('hidden'); loginBox.classList.add('hidden');
          info.textContent=`ƒêang ƒëƒÉng nh·∫≠p: ${user.email||''} ‚Äî Verified: ${user.emailVerified?'YES':'NO'}`;
          if(['hoandovan370@gmail.com'].includes(user.email||'')){ adminPanel.classList.remove('hidden'); bindAdminList(); }
          else adminPanel.classList.add('hidden');
        }else{ uidPlace.textContent='N/A'; adminBar.classList.add('hidden'); loginBox.classList.remove('hidden'); adminPanel.classList.add('hidden'); }
      }

      function bindAdminList(){
        const q=query(collection(db,'guestbook'),orderBy('createdAt','desc'));
        onSnapshot(q,(snap)=>{
          const list=document.getElementById('pending-list'); list.innerHTML="";
          snap.forEach(docSnap=>{
            const d=docSnap.data(); const id=docSnap.id;
            const when=d.createdAt?.toDate?d.createdAt.toDate().toLocaleString('vi-VN'):"";
            const isHidden=d.hidden===true;
            const li=document.createElement('li');
            li.className="p-4 rounded-xl border bg-white flex items-start justify-between gap-4";
            li.innerHTML=`<div>
                            <p class="font-semibold ${isHidden?'line-through text-coffee-500/60':''}">${d.name||''}</p>
                            <p class="${isHidden?'line-through text-coffee-500/60':''}">${d.message||''}</p>
                            <p class="text-xs text-coffee-600/70 mt-1">${when}</p>
                          </div>
                          <button data-id="${id}" data-hide="${!isHidden}" class="px-3 py-1 rounded-md border ${isHidden?'bg-green-50 border-green-300 text-green-700':'bg-rose-50 border-rose-300 text-rose-700'}">
                            ${isHidden?'Hi·ªán':'·∫®n'}
                          </button>`;
            list.appendChild(li);
          });
        });
        document.getElementById('pending-list').addEventListener('click',async(e)=>{
          const btn=e.target.closest('button[data-id]'); if(!btn) return;
          const id=btn.getAttribute('data-id'); const hide=btn.getAttribute('data-hide')==='true';
          try{ if(auth.currentUser) await getIdToken(auth.currentUser,true); await updateDoc(doc(db,'guestbook',id),{hidden:!!hide}); }
          catch(err){ console.error(err); alert("Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t. Ki·ªÉm tra Rules & email admin."); }
        });
      }
      onAuthStateChanged(auth,updateUI);
    }

    /* ---------- Countdown ---------- */
    const target=new Date('2025-10-10T18:00:00+07:00').getTime();
    function tick(){
      const now=Date.now(), d=Math.max(0,target-now);
      const days=Math.floor(d/864e5), hours=Math.floor(d/36e5)%24, mins=Math.floor(d/6e4)%60, secs=Math.floor(d/1e3)%60;
      document.getElementById('days').textContent=days;
      document.getElementById('hours').textContent=hours.toString().padStart(2,'0');
      document.getElementById('mins').textContent=mins.toString().padStart(2,'0');
      document.getElementById('secs').textContent=secs.toString().padStart(2,'0');
    }
    tick(); setInterval(tick,1000);
    document.getElementById('current-year').textContent=new Date().getFullYear();

    /* ---------- Music (autoplay + mute) ---------- */
    const DEFAULT_MUSIC="https://cdn.pixabay.com/download/audio/2022/04/05/audio_987b1b0d2d.mp3?filename=romantic-ambient-112996.mp3";
    const audio=document.getElementById('bgm');
    const musicParam=params.get('music');
    audio.src=musicParam?decodeURIComponent(musicParam):DEFAULT_MUSIC;
    const icoOn=document.getElementById('icon-sound-on'); const icoOff=document.getElementById('icon-sound-off');
    function setMuted(m){ audio.muted=m; (m?icoOn.classList.add('hidden'):icoOn.classList.remove('hidden')); (m?icoOff.classList.remove('hidden'):icoOff.classList.add('hidden')); try{localStorage.setItem('wedding-muted',m?'1':'0')}catch{} }
    try{ setMuted(localStorage.getItem('wedding-muted')==='1'); }catch{ setMuted(false); }
    async function tryPlay(){
      try{ await audio.play(); }
      catch(e){
        const wasMuted=audio.muted; audio.muted=true;
        try{ await audio.play(); }catch{}
        const unlock=()=>{ if(!wasMuted){ audio.muted=false; setMuted(false);} window.removeEventListener('click',unlock); window.removeEventListener('touchstart',unlock); };
        window.addEventListener('click',unlock,{once:true,passive:true});
        window.addEventListener('touchstart',unlock,{once:true,passive:true});
      }
    }
    tryPlay();
    document.getElementById('music-btn').addEventListener('click',()=>setMuted(!audio.muted));

    /* ---------- Envelope open ---------- */
    const INVITE_IMAGE_URL="https://images.unsplash.com/photo-1520614073990-dd602f64d05d?q=80&w=1260&auto=format&fit=crop";
    const SEAL_IMAGE_URL="https://images.unsplash.com/photo-1591893502434-581c8e98f3a3?q=80&w=640&auto=format&fit=crop";
    document.querySelector('#cover .card-inner').style.setProperty('--invite-image',`url('${INVITE_IMAGE_URL}')`);
    document.getElementById('seal-img').src=SEAL_IMAGE_URL;

    const cover=document.getElementById('cover');
    const openCover=()=>{ if(cover.classList.contains('opened')) return;
      cover.classList.add('opened'); setTimeout(()=>{ cover.style.display='none'; },2300); };
    setTimeout(openCover,900);           // t·ª± m·ªü sau 0.9s
    cover.addEventListener('click',openCover,{passive:true}); // ch·∫°m ƒë·ªÉ m·ªü ngay

    /* ---------- Parallax & reveal ---------- */
    const hero=document.getElementById('hero-bg');
    window.addEventListener('scroll',()=>{ const y=window.scrollY*.25; hero.style.transform=`translate3d(0,${y}px,0)`; },{passive:true});
    const io=new IntersectionObserver(ents=>{ents.forEach(e=>{if(e.isIntersecting) e.target.classList.add('show');});},{threshold:.15});
    document.querySelectorAll('.reveal').forEach(el=>io.observe(el));

    /* ---------- Lightbox for gallery ---------- */
    const grid=document.getElementById('gallery-grid');
    const sources=Array.from(grid.querySelectorAll('img')).map(img=>img.getAttribute('data-full')||img.src);
    let idx=0,startX=0;
    const lb=document.createElement('div');
    lb.className='lb-backdrop';
    lb.innerHTML=`<button class="lb-close" aria-label="ƒê√≥ng">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#111" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg>
      </button>
      <button class="lb-btn lb-prev" aria-label="·∫¢nh tr∆∞·ªõc">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#111" stroke-width="2"><path d="m15 18-6-6 6-6"/></svg>
      </button>
      <img class="lb-img" alt="preview">
      <button class="lb-btn lb-next" aria-label="·∫¢nh sau">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#111" stroke-width="2"><path d="m9 6 6 6-6 6"/></svg>
      </button>`;
    document.body.appendChild(lb);
    const imgEl=lb.querySelector('.lb-img'); const prevB=lb.querySelector('.lb-prev'); const nextB=lb.querySelector('.lb-next'); const closeB=lb.querySelector('.lb-close');
    function show(i){ idx=(i+sources.length)%sources.length; imgEl.src=sources[idx]; lb.classList.add('active'); }
    function hide(){ lb.classList.remove('active'); imgEl.src=''; }
    grid.addEventListener('click',e=>{ const img=e.target.closest('img'); if(!img) return; const i=Array.from(grid.querySelectorAll('img')).indexOf(img); show(i); });
    prevB.addEventListener('click',()=>show(idx-1)); nextB.addEventListener('click',()=>show(idx+1)); closeB.addEventListener('click',hide);
    lb.addEventListener('click',e=>{ if(e.target===lb) hide(); });
    window.addEventListener('keydown',e=>{ if(!lb.classList.contains('active')) return; if(e.key==='Escape') hide(); if(e.key==='ArrowLeft') show(idx-1); if(e.key==='ArrowRight') show(idx+1); });
    imgEl.addEventListener('touchstart',e=>{ startX=e.touches[0].clientX; },{passive:true});
    imgEl.addEventListener('touchend',e=>{ const dx=e.changedTouches[0].clientX-startX; if(Math.abs(dx)>40) (dx>0?prevB:nextB).click(); });
  </script>
</body>
</html>
