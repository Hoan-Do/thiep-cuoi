<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ho√†n&Huy·ªÅn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">

    <!-- Firebase (v11 modular) - KH√îNG d√πng Auth ƒë·ªÉ tr√°nh l·ªói 400 admin-restricted-operation -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import { 
        getFirestore, collection, addDoc, onSnapshot, query, where, orderBy, serverTimestamp, 
        doc, updateDoc 
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      /* TODO: Thay c·∫•u h√¨nh d∆∞·ªõi b·∫±ng c·∫•u h√¨nh th·∫≠t c·ªßa b·∫°n trong Firebase Console > Project settings > General */
      const firebaseConfig = {
        apiKey: "AIzaSyBA68TNBDx4T23PfkZTcU1RwWmDeQUgY",
        authDomain: "thiep-cuoi-c3d08.firebaseapp.com",
        projectId: "thiep-cuoi-c3d08",
        storageBucket: "thiep-cuoi-c3d08.appspot.com",
        messagingSenderId: "221614290",
        appId: "1:221614290:web:a3db7a9973261b9b3a0d8b"
      };

      // Kh·ªüi t·∫°o
      const app = initializeApp(firebaseConfig);
      const db  = getFirestore(app);

      // Hi·ªÉn th·ªã t√™n kh√°ch m·ªùi (param ?to=...)
      const urlParams = new URLSearchParams(window.location.search);
      const guestName = urlParams.get('to');
      document.addEventListener('DOMContentLoaded', () => {
        if (guestName) {
          const el = document.getElementById('guest-name-display');
          if (el) el.textContent = decodeURIComponent(guestName);
        }
        // Kh√¥ng d√πng Auth => user-id l√† N/A
        const uidEl = document.getElementById('user-id');
        if (uidEl) uidEl.textContent = "N/A";
        // Load l·ªùi ch√∫c
        loadGuestbook();
      });

      // G·ª≠i l·ªùi ch√∫c
      window.submitGuestbook = async () => {
        const nameInput    = document.getElementById('guest-name');
        const messageInput = document.getElementById('guest-message');
        const formStatus   = document.getElementById('form-status');
        const name = (nameInput?.value || "").trim();
        const message = (messageInput?.value || "").trim();

        if (!name || !message) {
          formStatus.textContent = 'Vui l√≤ng ƒëi·ªÅn t√™n v√† l·ªùi ch√∫c.';
          formStatus.className = 'text-red-500 mt-2';
          return;
        }
        try {
          await addDoc(collection(db, 'guestbook'), {
            name, 
            message, 
            createdAt: serverTimestamp(), 
            approved: true
          });
          if (nameInput) nameInput.value = '';
          if (messageInput) messageInput.value = '';
          formStatus.textContent = 'L·ªùi ch√∫c c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng!';
          formStatus.className = 'text-green-500 mt-2';
        } catch (e) {
          console.error('Error adding document:', e);
          formStatus.textContent = 'C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.';
          formStatus.className = 'text-red-500 mt-2';
        }
      };

      // T·∫£i danh s√°ch l·ªùi ch√∫c ƒë√£ duy·ªát
      function loadGuestbook() {
        const q = query(
          collection(db, 'guestbook'),
          where('approved', '==', true),
          orderBy('createdAt', 'desc')
        );
        onSnapshot(q, (snap) => {
          const list = document.getElementById('guestbook-list');
          if (!list) return;
          list.innerHTML = '';
          snap.forEach((docSnap) => {
            const data = docSnap.data();
            const li = document.createElement('li');
            li.className = 'bg-stone-50 p-4 rounded-xl shadow-sm mb-4 border border-stone-200';
            const dateStr = data.createdAt?.toDate ? data.createdAt.toDate().toLocaleString('vi-VN') : '';
            li.innerHTML = `
              <p class="font-bold text-lg text-rose-500">${data.name ?? ''}</p>
              <p class="text-stone-700 mt-2 italic">${data.message ?? ''}</p>
              <p class="text-xs text-stone-500 mt-2 text-right">G·ª≠i l√∫c: ${dateStr}</p>
            `;
            list.appendChild(li);
          });
        });
      }

      // (Tu·ª≥ ch·ªçn) H√†m duy·ªát/·∫©n l·ªùi ch√∫c n·∫øu sau n√†y b·∫°n b·∫≠t rule cho ph√©p update
      window.approveMessage = async (docId) => {
        try {
          await updateDoc(doc(db, 'guestbook', docId), { approved: true });
        } catch (e) { console.error('approveMessage error:', e); }
      };
      window.hideMessage = async (docId) => {
        try {
          await updateDoc(doc(db, 'guestbook', docId), { approved: false });
        } catch (e) { console.error('hideMessage error:', e); }
      };
    </script>

    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f8f0e5;
            color: #4b5563; /* text-gray-600 */
            scroll-behavior: smooth;
        }
        .playfair-font {
            font-family: 'Playfair Display', serif;
        }
        .bg-cover-image {
            background-image: url('https://placehold.co/1200x800/e0c2a5/fff?text=·∫¢nh+c∆∞·ªõi+ƒë·∫πp');
            background-size: cover;
            background-position: center;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Trang b√¨a -->
    <header id="home" class="h-screen bg-cover-image flex flex-col justify-center items-center text-center text-white p-4 relative">
        <div class="absolute inset-0 bg-black opacity-40"></div>
        <div class="relative z-10">
            <h1 class="playfair-font text-4xl sm:text-6xl md:text-8xl font-bold mb-4 animate-fadeIn">VƒÉn Ho√†n & Ng·ªçc Huy·ªÅn</h1>
            <p class="quicksand-font text-lg sm:text-xl md:text-2xl font-semibold mb-6 animate-fadeInDelay">Tr√¢n tr·ªçng k√≠nh m·ªùi <span id="guest-name-display" class="font-bold"></span></p>
            <p class="quicksand-font text-lg sm:text-xl md:text-2xl animate-fadeInDelay">Th·ª© B·∫£y, ng√†y 10 th√°ng 10 nƒÉm 2025</p>
        </div>
        <a href="#details" class="absolute bottom-10 animate-bounce cursor-pointer">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
        </a>
    </header>

    <!-- Chi ti·∫øt s·ª± ki·ªán -->
    <section id="details" class="py-16 px-4 bg-white text-center">
        <h2 class="playfair-font text-3xl font-bold text-rose-500 mb-8">Chi Ti·∫øt S·ª± Ki·ªán</h2>
        <div class="max-w-3xl mx-auto space-y-8 md:space-y-0 md:flex md:gap-8">
            <div class="flex-1 bg-stone-50 p-6 rounded-3xl shadow-lg border border-stone-200">
                <h3 class="playfair-font text-2xl font-semibold text-stone-700 mb-4">L·ªÖ Th√†nh H√¥n</h3>
                <p class="quicksand-font text-lg font-semibold mb-2 text-rose-500">T·∫°i nh√† trai</p>
                <p class="mb-1">‚è∞ Th·ªùi gian: <span class="font-semibold">09:00</span></p>
                <p class="mb-1">üìÖ Ng√†y: <span class="font-semibold">Th·ª© B·∫£y, ng√†y 10/10/2025</span></p>
                <p>üìç ƒê·ªãa ƒëi·ªÉm: <a href="https://maps.app.goo.gl/placeholder1" target="_blank" class="font-semibold text-blue-600 hover:underline">Nh√† ri√™ng ch√∫ r·ªÉ</a></p>
            </div>
            <div class="flex-1 bg-stone-50 p-6 rounded-3xl shadow-lg border border-stone-200">
                <h3 class="playfair-font text-2xl font-semibold text-stone-700 mb-4">Ti·ªác C∆∞·ªõi</h3>
                <p class="quicksand-font text-lg font-semibold mb-2 text-rose-500">T·∫°i nh√† h√†ng</p>
                <p class="mb-1">‚è∞ Th·ªùi gian: <span class="font-semibold">18:00</span></p>
                <p class="mb-1">üìÖ Ng√†y: <span class="font-semibold">Th·ª© B·∫£y, ng√†y 10/10/2025</span></p>
                <p>üìç ƒê·ªãa ƒëi·ªÉm: <a href="https://maps.app.goo.gl/placeholder2" target="_blank" class="font-semibold text-blue-600 hover:underline">Nh√† H√†ng ABC, 123 ƒê∆∞·ªùng XYZ, TP. HCM</a></p>
            </div>
        </div>
    </section>

    <!-- C√¢u chuy·ªán t√¨nh y√™u -->
    <section id="story" class="py-16 px-4 bg-rose-50 text-center">
        <h2 class="playfair-font text-3xl font-bold text-rose-500 mb-8">C√¢u Chuy·ªán C·ªßa Ch√∫ng T√¥i</h2>
        <div class="max-w-4xl mx-auto">
            <div class="md:flex md:items-center md:gap-8 mb-8">
                <div class="md:w-1/2 mb-4 md:mb-0">
                    <img src="https://placehold.co/600x400/fff3d6/e0c2a5?text=·∫¢nh+k·ª∑+ni·ªám+1" alt="Our story photo 1" class="rounded-3xl shadow-lg w-full">
                </div>
                <div class="md:w-1/2 text-left">
                    <h3 class="playfair-font text-xl font-semibold text-stone-700 mb-2">L·∫ßn ƒë·∫ßu g·∫∑p g·ª°...</h3>
                    <p class="text-sm text-stone-600 leading-relaxed">C√¢u chuy·ªán t√¨nh y√™u c·ªßa ch√∫ng t√¥i b·∫Øt ƒë·∫ßu t·ª´ m·ªôt bu·ªïi g·∫∑p g·ª° t√¨nh c·ªù. √Ånh m·∫Øt ƒë·∫ßu ti√™n, n·ª• c∆∞·ªùi ƒë·∫ßu ti√™n... ƒë·ªÅu l√† nh·ªØng kho·∫£nh kh·∫Øc ƒë√°ng nh·ªõ, l√† ƒëi·ªÉm kh·ªüi ƒë·∫ßu cho m·ªôt h√†nh tr√¨nh d√†i ƒë·∫ßy ·∫Øp k·ª∑ ni·ªám.</p>
                </div>
            </div>
            <div class="md:flex md:flex-row-reverse md:items-center md:gap-8">
                <div class="md:w-1/2 mb-4 md:mb-0">
                    <img src="https://placehold.co/600x400/fff3d6/e0c2a5?text=·∫¢nh+k·ª∑+ni·ªám+2" alt="Our story photo 2" class="rounded-3xl shadow-lg w-full">
                </div>
                <div class="md:w-1/2 text-left">
                    <h3 class="playfair-font text-xl font-semibold text-stone-700 mb-2">H√†nh tr√¨nh y√™u th∆∞∆°ng...</h3>
                    <p class="text-sm text-stone-600 leading-relaxed">Ch√∫ng t√¥i ƒë√£ c√πng nhau v∆∞·ª£t qua bao th·ª≠ th√°ch, chia s·∫ª ni·ªÅm vui v√† c·∫£ nh·ªØng n·ªói bu·ªìn. M·ªói kho·∫£nh kh·∫Øc ƒë·ªÅu tr·ªü th√†nh m·ªôt ph·∫ßn c·ªßa c√¢u chuy·ªán, m·ªôt vi√™n g·∫°ch x√¢y n√™n ng√¥i nh√† h·∫°nh ph√∫c c·ªßa ch√∫ng t√¥i.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- B·ªô s∆∞u t·∫≠p ·∫£nh -->
    <section id="gallery" class="py-16 px-4 bg-white text-center">
        <h2 class="playfair-font text-3xl font-bold text-rose-500 mb-8">Album ·∫¢nh C∆∞·ªõi</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 max-w-6xl mx-auto">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+1" alt="Gallery photo 1" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+2" alt="Gallery photo 2" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+3" alt="Gallery photo 3" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+4" alt="Gallery photo 4" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+5" alt="Gallery photo 5" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+6" alt="Gallery photo 6" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+7" alt="Gallery photo 7" class="w-full h-auto rounded-xl shadow-md">
            <img src="https://placehold.co/400x400/e0c2a5/fff?text=·∫¢nh+8" alt="Gallery photo 8" class="w-full h-auto rounded-xl shadow-md">
        </div>
    </section>

    <!-- S·ªï l∆∞u b√∫t -->
    <section id="guestbook" class="py-16 px-4 bg-rose-50 text-center">
        <h2 class="playfair-font text-3xl font-bold text-rose-500 mb-8">S·ªï L∆∞u B√∫t & L·ªùi Ch√∫c</h2>
        <div class="max-w-2xl mx-auto">
            <!-- Form g·ª≠i l·ªùi ch√∫c -->
            <div class="bg-white p-6 rounded-3xl shadow-lg border border-stone-200 mb-8">
                <form onsubmit="event.preventDefault(); submitGuestbook();">
                    <div class="mb-4">
                        <label for="guest-name" class="block text-sm font-medium text-gray-700 text-left mb-1">T√™n c·ªßa b·∫°n:</label>
                        <input type="text" id="guest-name" class="block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                    </div>
                    <div class="mb-4">
                        <label for="guest-message" class="block text-sm font-medium text-gray-700 text-left mb-1">L·ªùi ch√∫c:</label>
                        <textarea id="guest-message" rows="4" class="block w-full rounded-md border-gray-300 shadow-sm p-2 border" required></textarea>
                    </div>
                    <button type="submit" class="w-full bg-rose-500 text-white rounded-md py-2 font-semibold hover:bg-rose-600 transition-colors">G·ª≠i L·ªùi Ch√∫c</button>
                    <p id="form-status" class="text-sm mt-2"></p>
                </form>
            </div>
            
            <!-- Danh s√°ch l·ªùi ch√∫c -->
            <ul id="guestbook-list" class="text-left mt-8">
                <!-- L·ªùi ch√∫c s·∫Ω ƒë∆∞·ª£c load t·∫°i ƒë√¢y -->
            </ul>
        </div>
        <p class="text-sm text-stone-400 mt-8">User ID c·ªßa b·∫°n: <span id="user-id">N/A</span></p>
    </section>

    <!-- Admin Panel (m·∫∑c ƒë·ªãnh ·∫©n) -->
    <section id="admin-panel" class="py-16 px-4 bg-white text-center hidden">
        <hr class="mb-8 border-t-2 border-stone-300"/>
        <h2 class="playfair-font text-3xl font-bold text-stone-700 mb-8">Trang Qu·∫£n L√Ω L·ªùi Ch√∫c</h2>
        <p class="text-stone-600 mb-4">C√°c l·ªùi ch√∫c ƒë√£ duy·ªát v√† b·ªã ·∫©n:</p>
        <div class="max-w-2xl mx-auto">
            <ul id="pending-list" class="text-left"></ul>
        </div>
    </section>

    <!-- Ch√¢n trang -->
    <footer class="bg-stone-900 text-white py-8 text-center">
        <p class="text-sm">Copyright ¬© <span id="current-year"></span> VƒÉn Ho√†n & Ng·ªçc Huy·ªÅn. All Rights Reserved.</p>
        <p class="text-xs text-stone-400 mt-2">ƒê∆∞·ª£c t·∫°o b·ªüi Gemini.</p>
    </footer>
    <script>
        document.getElementById('current-year').textContent = new Date().getFullYear();
    </script>
</body>
</html>
